---
title: "[iOS] TCA Ã— Firestore ã§å‹é”ãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸ"
emoji: "ğŸª¢"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ios, swiftui, tca, firebase, firestore]
published: true
---

## ä½•ã‚’ã¤ãã£ãŸã‹

äººç‰©ã®æƒ…å ±ã‚’ç®¡ç†ã§ãã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚

ã‚°ãƒ«ãƒ¼ãƒ—ã‚‚ä½œæˆã§ãã€ä¾‹ãˆã°ã€Œå‹é”ã€ã‚„ã€Œå®¶æ—ã€ãªã©ã®ã‚°ãƒ«ãƒ¼ãƒ—ã§æ•´ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/friend-list-app-with-tca-firestore/app-screen-shot.png)

https://apps.apple.com/jp/app/id6475261189

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰
https://github.com/yyokii/RelNet

## ãªãœã¤ãã£ãŸã®

1ã¤ã¯ TCA ã®ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã§ã™ã€‚æ¥­å‹™ã§åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§å‹‰å¼·ã¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚

ã‚‚ã†1ã¤ã¯è‡ªåˆ†ãŒæ¬²ã—ã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚

äººã®æƒ…å ±ã‚’ã¿ãªã•ã‚“ã¯ã©ã†ç®¡ç†ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

è‡ªåˆ†ã¯ã€Œãƒ¡ãƒ¢ã€ã‚¢ãƒ—ãƒªã«æ›¸ã„ãŸã‚Šã€ŒTrelloã€ã«æ›¸ã„ãŸã‚Šã§ã€ã¾ã¨ã¾ã£ã¦ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ãªã„ã¨ãµã¨è¦‹ã‚‹ã¨ãã«ä¸ä¾¿ãªã®ã¨ã€æ›¸ãæ„æ¬²ã‚‚ã‚ã¾ã‚Šèµ·ãã¾ã›ã‚“ã§ã—ãŸã€‚

iOS ã«ã¯æ¨™æº–ã®ã€Œé€£çµ¡å…ˆã€ã‚¢ãƒ—ãƒªãŒã‚ã‚Šã¾ã™ãŒã€ã€Œé€£çµ¡å…ˆã€ã¨ã„ã†ã‚¢ãƒ—ãƒªåã®é€šã‚Šé€£çµ¡å…ˆã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã«ç‰¹åŒ–ã—ãŸã‚¢ãƒ—ãƒªã«ãªã£ã¦ã„ã¾ã™ã€‚

* é€£çµ¡å…ˆï¼ˆé›»è©±ç•ªå·ã‚„Slackï¼‰ã‚’çŸ¥ã‚‰ãªã„ã‘ã©ãŸã¾ã«ä¼šã†äºº
* èª•ç”Ÿæ—¥ã‚„è¶£å‘³ã€å¥½ããªé£Ÿã¹ç‰©ãªã©ãã®äººã«é–¢é€£ã™ã‚‹æƒ…å ±

ã“ã®æƒ…å ±ã‚’ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ã¨å¹¸ã›ã ãªã¨æ€ã„ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚

## åˆ©ç”¨ã—ãŸã‚‚ã®

### Teck Stacks

* SwiftUI
* The Composable Architecture
* Xcode Cloud
* Firebase
  * Firebase Auth
  * Firestore
  * Firebase Crashlytics
  * Cloud Functions for Firebase

ç‰¹ã«å¤‰ã‚ã£ãŸã‚‚ã®ã¯æ¡ç”¨ã—ã¦ãŠã‚‰ãšã‚ˆãã‚ã‚‹ã‚‚ã®ã ã¨æ€ã„ã¾ã™ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã€æ…£ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Š Firebase ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ãƒ‡ã‚¶ã‚¤ãƒ³

* SF Symbols
* ChatGPT
* Clipdrop

ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å‡ã‚‹ã¨ä½œæˆç›®çš„ã‹ã‚‰ãšã‚Œã¦ã—ã¾ã†ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³å®Ÿç¾ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã†ï¼‰ã®ã¨ã€ãã“ã«æ‹˜ã£ã¦ã†ã¾ãã„ã£ãŸè©¦ã—ãŒãªã„ã®ã§ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ã«ã—ã¾ã—ãŸã€‚

iOSã®åŸºæœ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ/è‰²ã‚’ä½¿ç”¨ã—ã‚¢ã‚¤ã‚³ãƒ³ãŒå¿…è¦ãªå ´åˆã¯ SF Symbols ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã¯ ChatGPT ã§ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã‚‚ã‚‰ã„ãªãŒã‚‰ DALL-E ã§ä½œæˆã— Clipdrop ã§æ‹¡å¼µã—ã€ä¸€éƒ¨æ‰‹ã‚’åŠ ãˆã¦ä½œæˆã—ã¾ã—ãŸã€‚ç”ŸæˆAIãŒã‚ã‚‹ã“ã¨ã§ã±ã£ã¨ãã‚Œã£ã½ã„ã‚¢ã‚¤ã‚³ãƒ³ãŒã§ãã‚‹ã®ã¯ã‚ã‚ŠãŒãŸã„ã§ã™ã­ã€‚

## è¨­è¨ˆ

TCAã§ã™ã€‚

ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚
å€‹äººé–‹ç™ºä¸”ã¤å°ã•ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹æ©æµãŒã‚ã¾ã‚Šãªã•ãã†ã¨æ€ã„ã“ã†ã—ã¾ã—ãŸã€‚

ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

![ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ](/images/friend-list-app-with-tca-firestore/folders.png)

## TCA

TCA ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ Examples ã® [SyncUps](https://github.com/pointfreeco/swift-composable-architecture/tree/main/Examples/SyncUps) ã‚’å‚è€ƒã«ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚

README ã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªã§ä½¿ç”¨ã•ã‚Œã‚‹ã§ã‚ã‚ã†ã‚‚ã®ãŒç¶²ç¾…ã•ã‚Œã¦ãŠã‚Šéå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

> This project demonstrates how to build a complex, real world application that deals with many forms of navigation (*e.g.*, sheets, drill-downs, alerts), many side effects (timers, speech recognizer, data persistence), and do so in a way that is testable and modular.
>
> ï¼ˆè¨³ï¼‰
>
> *ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã•ã¾ã–ã¾ãªå½¢å¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (ã‚·ãƒ¼ãƒˆ*ã€ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã€ã‚¢ãƒ©ãƒ¼ãƒˆãªã©)ã€å¤šãã®å‰¯ä½œç”¨ (ã‚¿ã‚¤ãƒãƒ¼ã€éŸ³å£°èªè­˜ã€ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–) ã‚’å‡¦ç†ã™ã‚‹è¤‡é›‘ãªä»Šæ—¥ã®ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚ã¾ãŸã€ãƒ†ã‚¹ãƒˆå¯èƒ½ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä½¿ç”¨ã—ã¦ã„ã‚‹ TCA ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ç¾çŠ¶ 1.6.0 ã§ã™ã€‚

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.4 ã§ @Reducer macro ãŒå°å…¥ã•ã‚Œã€1.5 ã§ã®æ›´æ–°ã‚‚ä½µã›ã‚‹ã¨ã€
ä»Šã¾ã§ã‚ˆã‚Šã‚­ãƒ¼ãƒ‘ã‚¹ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ãŒå¯èƒ½ã«ãªã‚Šã¾ã™

Scope 

```diff swift
-       Scope(state: \.login, action: /Action.login) {
+       Scope(state: \.login, action: \.login) {
            Login()
        }
```

ifLet

```diff swift
-       .ifLet(\.$alert, action: /Action.alert)
+       .ifLet(\.$alert, action: \.alert)
```

navigationDestination

```diff swift
       .navigationDestination(
-           store: store.scope(state: \.$destination, action: Main.Action.destination),
-           state: /Main.Destination.State.personDetail,
-           action: Main.Destination.Action.personDetail
+           store: store.scope(state: \.$destination.personDetail, action: \.destination.personDetail)
        ) {
            PersonDetailView(store: $0)
        }
```

ã¾ãŸã€`TaskResult` ã‚‚ Deprecated ã¨ãªã£ã¦ã„ã¾ã™ã€‚
è©³ç´°ã¯ã“ã¡ã‚‰:  [Moving off of TaskResultin page link](https://pointfreeco.github.io/swift-composable-architecture/main/documentation/composablearchitecture/migratingto1.4/#Moving-off-of-TaskResult)

### TCA ã¨ Firestore

Firestore ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã¨ Firebase Auth ã§ã®èªè¨¼å‡¦ç†ç”¨ã« Dependency ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ã‚’ listen ã™ã‚‹ã‚‚ã®ã«ã¤ã„ã¦ã¯ `AsyncThrowingStream` ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

å‚è€ƒ: 
 https://zenn.dev/zones/articles/5f845b065e64f5

## SwiftUI

ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ç®‡æ‰€ã¯ã„ã‚ã‚†ã‚‹ãƒ•ãƒ­ãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ãªã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯ Apple ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
[Food Truck: Building a SwiftUI multiplatform app | Apple Developer Documentation](https://developer.apple.com/documentation/swiftui/food_truck_building_a_swiftui_multiplatform_app/)

![ãƒ•ãƒ­ãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ](/images/friend-list-app-with-tca-firestore/group-layout.png)

ã¾ãŸã€String Ctalog ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
å°å…¥ãŒç°¡å˜ã§ã‚µã‚¯ãƒƒã¨ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã§ãã¦ã„ã„ã§ã™ã­ã€‚

String Catalog ã®ã‚­ãƒ¼åã«ã¤ã„ã¦ã¯ã€

* ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã—ã¦ã„ãªã„ã®ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‹ã‚‹ã‚ˆã†ãªå‘½åã‚’ã—ã¦é‡è¤‡ãŒç”Ÿã˜ãªã„ã‚ˆã†ã«
* ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã•ã‚Œã¦ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã‚ˆã†ã« "login-alert-title" ã®ã‚ˆã†ãªå½¢å¼ã§çµ±ä¸€

ã¨ã—ã¾ã—ãŸã€‚

![String Catalog](/images/friend-list-app-with-tca-firestore/string-catalog.png)

## ä»Šå¾Œ

AIæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

+ å…¥åŠ›æƒ…å ±ã‚’å…ƒã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã‚‹
+ å…¥åŠ›æƒ…å ±ã‚’å…ƒã«ãƒˆãƒ¼ã‚¯ãƒˆãƒ”ãƒƒã‚¯ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’ææ¡ˆã—ã¦ãã‚Œã‚‹

ã®ã‚ˆã†ãªæ©Ÿèƒ½ãŒã‚ã‚‹ã¨é¢ç™½ãã†ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒªãŒã€æ—¥ã€…ã®å‡ºä¼šã„ã‚’ã‚ˆã‚Šãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ãŸã‚ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

https://apps.apple.com/jp/app/id6475261189

https://github.com/yyokii/RelNet
